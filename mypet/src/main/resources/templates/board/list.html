<html layout:decorate="~{layout}">
  <div layout:fragment="content" class="container">
      <div class="inner board_wrap">
        <h2>커뮤니티</h2>
        <div class="board_list_area">
          <div class="input_wrap">
            <input type="text" id="search_kw" class="form_control" th:value="${kw}" placeholder="검색어를 입력해주세요." />
            <button class="btn btn_search" type="button" id="btn_search" ><i class="fa-solid fa-magnifying-glass"></i></button>
          </div>
        <table class="board_list_wrap">
          <thead>
            <tr>
              <th>번호</th>
              <th>제목</th>
              <th>작성자</th>
              <th>조회수</th>
              <th>작성일</th>
            </tr>
          </thead>
          <tbody>
          
<!--           	<tr th:if="${paging.empty}"> -->
			<tr th:if="${paging == null or paging.empty}">
              <td colspan="5">게시글이 없습니다.</td>
            </tr>
            <tr th:if="${topBoards != null and not #lists.isEmpty(topBoards)}" 
            th:each="board : ${topBoards}" class="top">
            	<td class="hot" >HOT<b>!</b></td>
            	<td class="title_td">
	                <a th:href="@{|/board/detail/${board.idx}|}">
	                 <span th:text="${board.title}" class="title"></span>
	                 <span class="comment_size" th:if="${#lists.size(board.commentList) > 0}" th:text="${#lists.size(board.commentList)}"></span>
	                </a>
	            </td>
                <td th:if="${board.author != null}" th:text="${board.author.userId}"></td>
                <td th:text="${board.views}"></td>
                <td th:text="${#temporals.format(board.createDate, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr th:each="board, loop : ${paging}">
            
              <td th:text="${board.idx}"></td>
              <td class="title_td">
                <a th:href="@{|/board/detail/${board.idx}|}">
                 <span th:text="${board.title}" class="title"></span>
                 <span class="comment_size" th:if="${#lists.size(board.commentList) > 0}" th:text="${#lists.size(board.commentList)}"></span>
                </a>
                
              </td>
              <td>
              	<span th:if="${board.author != null}" th:text="${board.author.userId}"></span>
              </td>
              <td th:text="${board.views}"></td>
              <td th:text="${#temporals.format(board.createDate, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            
          </tbody>
        </table>
        <div>
        	<a th:href="@{/board/write}" class="btn write_btn">글쓰기</a>        
        </div>
        </div>
        <!-- 페이징처리 시작 -->
	    <div th:if="${paging != null and not paging.empty}">
	        <ul class="pagination_c">
	            <li class="arrow prev" th:classappend="${!paging.hasPrevious} ? 'disabled'">
	                <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
	                    <span>이전</span>
	                </a>
	            </li>
	            <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
	            	th:if="${page >= ((paging.number/10) * 10) and page < ((paging.number/10) * 10 + 10)}"
	                th:classappend="${page == paging.number} ? 'active'" 
	                class="number">
	                <a th:text="${page+1}" class="page-link" href="javascript:void(0)" th:data-page="${page}"></a>
	            </li>
	            <li class="arrow next" th:classappend="${!paging.hasNext} ? 'disabled'">
	                <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">
	                    <span>다음</span>
	                </a>
	            </li>
	        </ul>
	    </div>
	    <!-- 페이징처리 끝 -->
	    <form th:action="@{/board/list}" method="get" id="searchForm">
	        <input type="hidden" id="kw" name="kw" th:value="${kw}">
	        <input type="hidden" id="page" name="page" th:value="${paging?.number}">
	    </form>
      </div>
    </div>
<script layout:fragment="script" type="text/javascript">
	const page_elements = document.querySelectorAll('.page-link');	
	Array.from(page_elements).forEach(
		function(element) {
			element.addEventListener('click', function(){
				const pageNum = this.dataset.page;
				document.querySelector('#page').value = pageNum;
				document.querySelector('#searchForm').submit();				
		});
	});
	
	const btn_search = document.querySelector('#btn_search');	
	btn_search.addEventListener('click', function(){
		const search_kw = document.querySelector('#search_kw').value.trim(); 
		if (search_kw === '') {
			alert('검색어를 입력해주세요.');
			return;
		}
		document.querySelector('#kw').value = search_kw;
		document.querySelector('#page').value = 0;
		document.querySelector('#searchForm').submit();				
	});	
	
</script>
</html>

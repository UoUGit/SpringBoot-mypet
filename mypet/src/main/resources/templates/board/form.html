<html layout:decorate="~{layout}">
<head>
<!-- include summernote css/js -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
  <div layout:fragment="content" class="container">
    <div class="inner write_wrap">
      <form th:object="${boardForm}" method="post">
      	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" id="csrf_token"/>
        <div th:replace="~{form_errors :: formErrorsFragment}"></div>
        <div class="mb-3 title_wrap">
          <input type="text" th:field="*{title}" placeholder="제목"/>
        </div>
        <div class="content_area">
          <textarea name="content" id="summernote" th:field="*{content}"></textarea>
        </div>
        <div class="btn_wrap"><input type="submit" value="등록" class="btn write_btn" /></div>
        
      </form>
      <div id="summernote"><p></p></div>
    </div>
 <script layout:fragment="script" type='text/javascript'>
  $(document).ready(function() {
	  var token = $("meta[name='_csrf']").attr("content");
	  var header = $("meta[name='_csrf_header']").attr("content");
	   
      $('#summernote').summernote({
   	   height: 500,
   	   lang : 'ko-KR',
	   toolbar : [
			['style', ['style'] ],
			['fontsize', ['fontsize']],
			['font',['bold','italic','underline','strikethrough','clear']],
			['color',['color']],
			['para',['paragraph']],
			['height',['height']],
			['table',['table']],
			['insert',['picture','link','hr']],
			['view',['codeview']]],
		fontSizes : ['8','10','12','14','16','18','20','22','24','28','30','36','50','72'],
		lineHeights : ['0.2','0.3','0.4','0.5','0.6','0.8','1.0','1.2','1.4','1.5','2.0','3.0'],
		callbacks: {
            onImageUpload: function(files) {
            	for (var i = 0; i < files.length; i++) {
                    uploadImage(files[i], this, token, header);
                }
            }
        }
    });
      
      function uploadImage(file, editor, token, header) {
          var formData = new FormData();
          formData.append('file', file);
          formData.append('_csrf', token);

          $.ajax({
              url: '/files/uploadSummernoteImageFile',
              type: 'POST',
              data: formData,
              contentType: false,
              processData: false,
              beforeSend: function(xhr) {
                  xhr.setRequestHeader(header, token);
              },
              success: function(data) {
                  var url = data.url;
                  $(editor).summernote('insertImage', url, function($image) {
                      $image.css('width', "60%");
                  });
              },
              error: function() {
                  alert('이미지 업로드 실패');
              }
          });
      }
  });
  
  
  
</script>
</div>  
</html>

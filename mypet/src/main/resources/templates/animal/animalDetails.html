<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container">
		<div class="inner animal_detail">
			<div th:if="${location == 'Seoul'}" class="animal-container">
				<div class="animal-photo">
					<img th:src="@{'http://' + ${animal.photoUrl}}" alt="동물 이미지" />
					<button class="like-button"
						th:onclick="'addLike(' + ${animal.id} + ')'">
						<i class="fas fa-heart"></i>
					</button>
				</div>
				<table class="animal-info">
					<tr>
						<td>동물번호</td>
						<td colspan="3" th:text="${animal.animalNo}"></td>
					</tr>
					<tr>
						<td>이름</td>
						<td th:text="${animal.nm}"></td>
						<td>입양 날짜</td>
						<td th:text="${animal.entrncDate}"></td>
					</tr>
					<tr>
						<td>종</td>
						<td th:text="${animal.spcs}"></td>
						<td>품종</td>
						<td th:text="${animal.breeds}"></td>
					</tr>
					<tr>
						<td>성별</td>
						<td th:text="${animal.sexdstn}"></td>
						<td>나이</td>
						<td th:text="${animal.age}"></td>
					</tr>
					<tr>
						<td>입양 상태</td>
						<td th:text="${animal.adpSttus}"></td>
						<td>임시보호 상태</td>
						<td th:text="${animal.tmprPrtcSttus}"></td>
					</tr>
				</table>
					<div th:utext="${animal.intrcnCn}"></div>
				</div>
			</div>

			<div th:if="${location == 'Gyeonggi'}" class="animal-container">
				<div class="animal-photo">
					<img
						th:src="${animal.imageCours.startsWith('http') ? animal.imageCours : 'http://' + animal.imageCours}"
						alt="동물 이미지" />
					<button class="like-button"
						th:onclick="'addLike(' + ${animal.id} + ')'">
						<i class="fas fa-heart"></i>
					</button>
				</div>
				<table class="animal-info">
					<tr>
						<td>동물번호</td>
						<td colspan="3" th:text="${animal.abdmIdntfyNo}"></td>
					</tr>
					<tr>
						<td>입양 날짜</td>
						<td colspan="3" th:text="${animal.entrncDate}"></td>
					</tr>
					<tr>
						<td>종</td>
						<td colspan="3" th:text="${animal.speciesNm}"></td>
					</tr>
					<tr>
						<td>성별</td>
						<td colspan="3" th:text="${animal.sexNm}"></td>
					</tr>
					<tr>
						<td>보호 여부</td>
						<td th:text="${animal.stateNm}"></td>
						<td>보호 장소</td>
						<td th:text="${animal.protectPlc}"></td>
					</tr>
				</table>
			</div>

			<div th:unless="${location}">
				<p>동물 정보를 찾을 수 없습니다.</p>
			</div>
			<div class="btn_wrap_B">
				<div th:if="${location == 'Seoul'}" class="animal-container">
					<a th:href="@{/adopt/adoptForm(animalId=${animal.id})}"
						class="btn">입양 신청하기</a>
				</div>
		
				<div th:if="${location == 'Gyeonggi'}" class="animal-container">
					<a th:href="@{/adopt/adoptForm(animalId=${animal.id})}"
						class="btn">입양 신청하기</a>
				</div>
			</div>
			<div class="list_btn">
				<a href="/animal/animalBoard"><i class="fa-solid fa-list"></i> 목록으로 돌아가기</a>		
			</div>
		</div>
		<input type="hidden" id="userIdx" th:value="${userIdx}" />
	</div>
<script>
    function addLike(animalId) {
        const userIdx = document.getElementById('userIdx').value;
        console.log('UserIdx:', userIdx); // userIdx 값 확인
        if (!userIdx) {
            console.error('User index is empty');
            return;
        }

        fetch(`/api/animals/${animalId}/like?userIdx=${encodeURIComponent(userIdx)}`, {
            method: 'POST',
        })
        .then(response => {
            if (response.ok) {
                console.log('Like added successfully');
            } else {
                console.log('Failed to add like');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function removeLike(animalId) {
        const userIdx = document.getElementById('userIdx').value;
        console.log('UserIdx:', userIdx); // userIdx 값 확인
        if (!userIdx) {
            console.error('User index is empty');
            return;
        }

        fetch(`/api/animals/${animalId}/like?userIdx=${encodeURIComponent(userIdx)}`, {
            method: 'DELETE',
        })
        .then(response => {
            if (response.ok) {
                console.log('Like removed successfully');
            } else {
                console.log('Failed to remove like');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>
</html>
